import{c as V}from"./copyToClipboard.bcb0a3c2.js";import{d as T,f as D,_ as q,N as x,az as M,r as b,w,ao as Y,aE as Z,bz as H,ad as J,o as c,a as k,g as L,u as p,F as P,i as z,q as R,aC as K,b as a,j as _,n as S,h as I,k as A,aF as Q,p as F,m as B,t as $,bA as W,au as X,l as E,av as ee,aD as se}from"./index.db4b08e0.js";import{c as te}from"./TMessage.30ab47ac.js";import{_ as ae}from"./TTooltip.vue_vue_type_style_index_0_lang.561ec907.js";import{m as j}from"./mutation.640962a3.js";import{s as O}from"./socket.2fbb088b.js";import{d as oe}from"./dayjs.min.cf2eabef.js";import{q as ne}from"./queryParser.785886e3.js";import{N as ie}from"./Popover.9be5e582.js";import{N as re}from"./Input.a8ee46ca.js";import"./index.eb8c481c.js";import"./use-compitable.ba41904e.js";import"./utils.5839b03b.js";import"./use-merged-state.119a85f6.js";import"./use-locale.145fb545.js";const le={class:"tpd-chatList scrollbar"},ue=T({__name:"SectionChatList",props:{status:null},setup(d){const v=d,h=D({loader:()=>q(()=>import("./SectionChatSingle.36c3cac5.js"),["assets/SectionChatSingle.36c3cac5.js","assets/SectionChatSingle.8cd9ebaa.css","assets/index.db4b08e0.js","assets/index.44fe606f.css","assets/mutation.640962a3.js","assets/queryParser.785886e3.js","assets/MiniPin.42e30b56.js","assets/MiniPin.27ce7216.css"]),loadingComponent:x}),g=D({loader:()=>q(()=>import("./SectionChatListZero.fc237e9d.js"),["assets/SectionChatListZero.fc237e9d.js","assets/SectionChatListZero.c58e5110.css","assets/index.db4b08e0.js","assets/index.44fe606f.css"]),loadingComponent:x}),n=D({loader:()=>q(()=>import("./TSpinner.f247bbba.js"),["assets/TSpinner.f247bbba.js","assets/TSpinner.554126ed.css","assets/index.db4b08e0.js","assets/index.44fe606f.css"]),loadingComponent:x}),l=M(),o=b([]),m=b(!1),C=({event:e,shopid:s})=>{if(s===String(l.query.shop)){const{msg_id:i,thumbnail:t,message:u,from_user_name:N,is_opposite:U}=e,y=o.value.map(G=>G.messageId).indexOf(i);y!==-1?o.value[y]={avatar:o.value[y].avatar,lastMessage:u.original_reply,messageId:o.value[y].messageId,username:o.value[y].username,isOpposite:U,unreadCount:i===Number(l.query.chat)?0:o.value[y].unreadCount+1,ispinned:o.value[y].ispinned}:o.value.push({isOpposite:U,avatar:t||"https://ik.imagekit.io/q8c93uv11zf/depositphotos_318221368-stock-illustration-missing-picture-page-for-website__1__D4wUizhS4P.jpg?ik-sdk-version=javascript-1.4.3&updatedAt=1644200363610",lastMessage:u.original_reply,messageId:i,username:N,unreadCount:1,ispinned:!1})}},r=(e,s="all")=>{j("getListUserChat","chat/users","POST",{filter:s,order:"desc",page:1,perPage:10,platform:"desktop",tab:"tab-seller"},null,{onSuccess:({data:i})=>{const{list:t}=i.chatList;o.value=t.map(u=>({avatar:u.attributes.contact.thumbnail,username:u.attributes.contact.name,lastMessage:u.attributes.lastReplyMessage,messageId:u.messageId,isOpposite:!1,unreadCount:u.attributes.unreads,ispinned:u.attributes.pinStatus!==0}))},onLoading:i=>m.value=i,onError:i=>o.value=[]},function(i){return i+`?shopid=${e}`})};return w(()=>v.status,e=>{if(e){const{shop:s}=l.query;r(String(s),e)}}),w(()=>l.query.shop,e=>{e&&r(e)},{immediate:!0}),w(()=>l.query.chat,e=>{e&&(o.value=o.value.map(s=>s.messageId===+e?{...s,unreadCount:0}:s))},{immediate:!0}),Y(()=>{O.on("rcv_message",C)}),Z(()=>{O.off("rcv_message",C)}),(e,s)=>{const i=H("stagger");return J((c(),k("div",le,[m.value?(c(),L(p(n),{key:0,style:{"min-height":"400px"},size:"xlarge",text:"Sedang memuat data chat..."})):o.value.length?(c(!0),k(P,{key:2},z(o.value,(t,u)=>(c(),L(p(h),{key:t.messageId,index:u,image:t.avatar,username:t.username,"last-message":t.lastMessage,"message-id":t.messageId,"is-opposite":t.isOpposite,"unread-count":t.unreadCount,ispinned:t.ispinned,style:{"flex-shrink":"0"}},null,8,["index","image","username","last-message","message-id","is-opposite","unread-count","ispinned"]))),128)):(c(),L(p(g),{key:1}))])),[[i,60]])}}});const de=R(ue,[["__scopeId","data-v-78c405df"]]),f=d=>(F("data-v-467503af"),d=d(),B(),d),ce={class:"tpd-sc-chatFilter"},pe={class:"userfinder"},me={class:"resultContainer"},_e=["src"],ve={class:"resultInfo"},fe={class:"fw-600 fs-12"},he={class:"fs-10 fw-500 fn-secondary"},ge={key:2,style:{color:"#999"},class:"p-2 fw-500 is-center"},be=f(()=>a("i",{class:"bi bi-sliders fs-11"},null,-1)),ye={class:"tpd-dropdowncontent"},ke={class:"tpd-dropdownlist"},Ce=f(()=>a("i",{class:"bi bi-chat-right-text fs-11"},null,-1)),Se=f(()=>a("span",{class:"fs-12"},"Semua",-1)),we=[Ce,Se],Ie=f(()=>a("i",{class:"bi bi-envelope-paper-fill fs-11"},null,-1)),xe=f(()=>a("span",{class:"fs-12"},"Sudah dibaca",-1)),Le=[Ie,xe],$e=f(()=>a("i",{class:"bi bi-envelope-check-fill fs-11"},null,-1)),Ne=f(()=>a("span",{class:"fs-12"},"Belum dibaca",-1)),De=[$e,Ne],qe=f(()=>a("i",{class:"bi bi-reply-fill fs-11"},null,-1)),Te=f(()=>a("span",{class:"fs-12"},"Belum dibalas",-1)),Me=[qe,Te],Re=T({__name:"SectionChatFilter",props:{status:null},emits:["update:status"],setup(d,{emit:v}){const h=d,g=M(),n=b(!1),l=b(!1),o=b({name:""}),m=b([]),C=Q((e,s,i)=>{j("findUserChat","chat/users/search","POST",{keyword:s,size:i},{shopid:e},{onSuccess:({data:t})=>{m.value=t.chatSearch.contact.data},onLoading:t=>l.value=t})},300),r=e=>{const{chat:s,...i}=g.query,t=ne({...i,chat:e});return["/rooms/chats",t].join("?")};return w(()=>o.value.name,e=>{const{shop:s}=g.query;e&&(n.value=!0,m.value=[],l.value=!0,C(String(s),e,10))}),w(()=>g.query,()=>{o.value={name:""},v("update:status","all")},{deep:!0}),(e,s)=>{const i=K("router-link");return c(),k("div",ce,[a("div",pe,[_(p(re),{onFocusin:s[0]||(s[0]=t=>n.value=!0),size:"small",placeholder:"Cari nama user...",value:o.value.name,"onUpdate:value":s[1]||(s[1]=t=>o.value.name=t),clearable:""},null,8,["value"]),a("div",{class:S([n.value&&o.value.name&&"findresult-on","findresult fs-13"])},[a("div",me,[m.value.length&&!l.value?(c(!0),k(P,{key:0},z(m.value,t=>(c(),k("div",{class:"result",key:t.msgId},[_(i,{onClick:s[2]||(s[2]=u=>n.value=!1),class:"overlay-lnk",to:r(t.msgId)},null,8,["to"]),a("img",{src:t.contact.attributes.thumbnail,alt:"r.contact.attributes.name"},null,8,_e),a("div",ve,[a("h4",fe,$(t.contact.attributes.name),1),a("span",he,$(p(oe)(+t.createTimeStr).format("DD MMM YYYY")),1)])]))),128)):!m.value.length&&l.value?(c(),L(p(x),{key:1,style:{"border-radius":"5px"},height:30})):(c(),k("div",ge," Pencarian tidak ada hasil "))])],2)]),_(p(ie),{placement:"bottom-start",raw:"","show-arrow":!1,style:{"box-shadow":"none",padding:"0"},trigger:"click"},{trigger:I(()=>[_(p(A),{secondary:"",class:"tpd-dropdowntrigger",size:"small"},{default:I(()=>[be]),_:1})]),default:I(()=>[a("div",ye,[a("div",ke,[a("div",{class:S(["dropdown-item",h.status==="all"&&"dropdown-item-active"]),onClick:s[3]||(s[3]=t=>v("update:status","all"))},we,2),a("div",{class:S(["dropdown-item",h.status==="read"&&"dropdown-item-active"]),onClick:s[4]||(s[4]=t=>v("update:status","read"))},Le,2),a("div",{class:S(["dropdown-item",h.status==="unread"&&"dropdown-item-active"]),onClick:s[5]||(s[5]=t=>v("update:status","unread"))},De,2),a("div",{class:S(["dropdown-item",h.status==="unreplied"&&"dropdown-item-active"]),onClick:s[6]||(s[6]=t=>v("update:status","unreplied"))},Me,2)])])]),_:1})])}}});const Ue=R(Re,[["__scopeId","data-v-467503af"]]),Ee=d=>(F("data-v-099763bc"),d=d(),B(),d),Oe={class:"tpd-usrcht"},Pe={class:"shopdetail"},ze={class:"fs-13 fw-600"},Ae=Ee(()=>a("i",{style:{color:"#555"},class:"fs-11 bi bi-files"},null,-1)),Fe={class:"fs-12 fw-400 fn-secondary"},Be=T({__name:"TRoomUserChatSection",setup(d){const v=M(),h=te(),g=b(!1),n=W({username:"",address:"Tidak diketahui",avatar:""}),l=b("all"),o=(r="",e="Nama toko")=>{V(r).then(()=>{h.info(e+" disalin")})},m=r=>{ee("getaccountinfo","akuns","GET",e=>e+"/"+r,null,{onSuccess:e=>{const{shopname:s,profile_url:i}=e.akun;if(n.username=s,n.avatar=i,e.address[0]){const{districtName:t,cityName:u,stateName:N}=e.address[0];n.address=[t,u,N].join(", ")}else n.address="Belum diset"},onLoading:e=>{g.value=e,e&&(n.username="Sedang memuat...",n.address="Sedang memuat...",n.avatar="")},onError:e=>{console.log(e),n.username="Oops!! Terjadi kesalahan",n.address="-",n.avatar=""}})},C=r=>{const{x:e,y:s}=r;r.preventDefault(),se([{label:"Salin nama toko",onClick:()=>{o(n.username,"Nama toko")},iconClass:"bi bi-files fs-11"},{label:"Salin alamat toko",onClick:()=>{o(n.address,"Alamat toko")},iconClass:"bi bi-geo-alt fs-11"},{label:"Salin URL Gambar",onClick:()=>{o(n.avatar,"URL Image")},iconClass:"bi bi-images fs-11"}],e,s)};return w(()=>v.query.shop,r=>{r&&m(r)},{immediate:!0}),(r,e)=>(c(),k("div",Oe,[a("div",{style:{"flex-shrink":"0"},class:"tpd-usrchtActv",onContextmenu:C},[a("div",{style:X({backgroundImage:`url('${n.avatar}')`}),class:S(["shopimg",g.value&&"shopimg-loading"])},null,6),a("div",Pe,[a("h4",ze,$(n.username),1),_(ae,{text:"Salin nama toko"},{default:I(()=>[_(p(A),{onClick:e[0]||(e[0]=s=>o(n.username,"Nama toko")),class:"copy-btn",size:"tiny",secondary:""},{default:I(()=>[Ae]),_:1})]),_:1}),a("span",Fe,$(n.address),1)])],32),_(p(E),{class:"my-0"}),_(Ue,{status:l.value,"onUpdate:status":e[1]||(e[1]=s=>l.value=s)},null,8,["status"]),_(p(E),{class:"my-0"}),_(de,{status:l.value},null,8,["status"])]))}});const ns=R(Be,[["__scopeId","data-v-099763bc"]]);export{ns as default};
